# üè¶ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üß© –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

–≠—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤–æ–∫—Ä—É–≥ **–ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞**, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω—ã:
- –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ,
- –∞–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏,
- –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞,
- –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–µ—Ä–µ–≤–æ–¥—ã, –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è),
- –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π,
- –∞–Ω—Ç–∏—Ñ—Ä–æ–¥-—Å–∏—Å—Ç–µ–º–∞ (–±–æ—Ä—å–±–∞ —Å –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ–º),
- –ø—É–±–ª–∏—á–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–±–∞–Ω–∫–∏, —Ñ–∏–ª–∏–∞–ª—ã, –±–∞–Ω–∫–æ–º–∞—Ç—ã).

–í—Å–µ –º–æ–¥—É–ª–∏ —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∏ –≤–Ω–µ—à–Ω–∏–µ —Å–≤—è–∑–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

---

## üîπ 1. –ú–æ–¥—É–ª—å "–ü—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞"

### –¢–∞–±–ª–∏—Ü—ã:
- `profile_profile`
- `profile_passport`
- `profile_actual_registration`
- `profile_audit`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–•—Ä–∞–Ω–∏—Ç **–æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ**:
- –∏–º—è –Ω–∞ –∫–∞—Ä—Ç–µ,
- –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ,
- –º–µ—Å—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∞–¥—Ä–µ—Å),
- –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `profile_profile`.
2. –í `profile_passport` –∑–∞–Ω–æ—Å—è—Ç—Å—è –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞.
3. –í `profile_actual_registration` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è.
4. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `profile_audit`.

---

## üîπ 2. –ú–æ–¥—É–ª—å "–°—á–µ—Ç–∞"

### –¢–∞–±–ª–∏—Ü—ã:
- `account_account_details`
- `account_account`
- `account_audit`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–û–ø–∏—Å—ã–≤–∞–µ—Ç **–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤**, –∏—Ö —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. `account_account_details` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–Ω–æ–º–µ—Ä —Å—á–µ—Ç–∞, –±–∞–ª–∞–Ω—Å, —Ñ–ª–∞–≥ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞, –≤–ª–∞–¥–µ–ª–µ—Ü).
2. `account_account` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞ (–æ–ø–µ—Ä–∞—Ü–∏–∏, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏).
3. `account_audit` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

–ö–∞–∂–¥—ã–π —Å—á–µ—Ç —Å–≤—è–∑–∞–Ω —Å `profile_profile` –ø–æ –ø–æ–ª—é `profile_id`.

---

## üîπ 3. –ú–æ–¥—É–ª—å "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ / –ü–µ—Ä–µ–≤–æ–¥—ã"

### –¢–∞–±–ª–∏—Ü—ã:
- `transfer_phone_transfer`
- `transfer_account_transfer`
- `transfer_card_transfer`
- `transfer_audit`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–•—Ä–∞–Ω–∏—Ç **–≤—Å–µ –≤–∏–¥—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤**, —Å–æ–≤–µ—Ä—à–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
- –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞,
- –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã,
- –ø–æ –Ω–æ–º–µ—Ä—É —Å—á–µ—Ç–∞.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ.
  - –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É ‚Äî –≤ `transfer_phone_transfer`.
2. –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∞—Ç–µ–ª—å, —Å—É–º–º–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, ID —Å—á–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (`account_details_id`).
3. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `transfer_audit`.

---

## üîπ 4. –ú–æ–¥—É–ª—å "–ê–Ω—Ç–∏—Ñ—Ä–æ–¥" (Anti-Fraud)

### –¢–∞–±–ª–∏—Ü—ã:
- `anti_fraud_suspicious_card_transfer`
- `anti_fraud_suspicious_account_transfer`
- `anti_fraud_suspicious_phone_transfer`
- `anti_fraud_audit`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –∏–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ—á–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –æ–¥–Ω–æ–π –∏–∑ —Ç–∞–±–ª–∏—Ü.
2. –•—Ä–∞–Ω—è—Ç—Å—è:
  - ID –ø–µ—Ä–µ–≤–æ–¥–∞,
  - —Ñ–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏,
  - –ø—Ä–∏—á–∏–Ω–∞,
  - –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è.
3. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `anti_fraud_audit`.

---

## üîπ 5. –ú–æ–¥—É–ª—å "–ü—É–±–ª–∏—á–Ω–∞—è –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"

### –¢–∞–±–ª–∏—Ü—ã:
- `public_bank_information_bank_details`
- `public_bank_information_license`
- `public_bank_information_certificate`
- `public_bank_information_branch`
- `public_bank_information_atm`
- `public_bank_information_audit`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–•—Ä–∞–Ω–∏—Ç **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–Ω–∫–µ –∏ –µ–≥–æ —Ñ–∏–ª–∏–∞–ª–∞—Ö**.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. `public_bank_information_bank_details` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –±–∞–Ω–∫–∞.
2. –ö –Ω–µ–π –ø—Ä–∏–≤—è–∑–∞–Ω—ã:
  - –ª–∏—Ü–µ–Ω–∑–∏–∏ (`public_bank_information_license`),
  - —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (`public_bank_information_certificate`).
3. `public_bank_information_branch` ‚Äî —Ñ–∏–ª–∏–∞–ª—ã, –∏—Ö –∞–¥—Ä–µ—Å–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã.
4. `public_bank_information_atm` ‚Äî –±–∞–Ω–∫–æ–º–∞—Ç—ã –∏ —Ä–µ–∂–∏–º –∏—Ö —Ä–∞–±–æ—Ç—ã.
5. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ `public_bank_information_audit`.

---

## üîπ 6. –ú–æ–¥—É–ª—å "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è / –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"

### –¢–∞–±–ª–∏—Ü–∞:
- `auth_users`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–•—Ä–∞–Ω–∏—Ç —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
- –ü–æ–ª—è: `username`, `password_hash`, `role_id`.
- –†–æ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∏–µ–Ω—Ç, –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä).
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Å `profile_profile`.

---

## üîπ 7. –ú–æ–¥—É–ª—å "–ò—Å—Ç–æ—Ä–∏—è"

### –¢–∞–±–ª–∏—Ü–∞:
- `history_history`

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
–°–æ–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ –≤—Å–µ–º –º–æ–¥—É–ª—è–º.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
- –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ audit-—Ç–∞–±–ª–∏—Ü—ã.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

## üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)

### –û–±—â–∞—è —Ü–µ–ø–æ—á–∫–∞:

1. üë§ –°–æ–∑–¥–∞–µ—Ç—Å—è **–ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞** ‚Üí `auth_users` + `profile_profile`.
2. ü™™ –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–∞—Å–ø–æ—Ä—Ç –∏ –∞–¥—Ä–µ—Å ‚Üí `profile_passport` –∏ `profile_actual_registration`.
3. üè¶ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—á–µ—Ç ‚Üí `account_account_details` (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—é).
4. üí∏ –°–æ–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–µ—Ä–µ–≤–æ–¥ ‚Üí –∑–∞–ø–∏—Å—å –≤ `transfer_*`.
5. üß† –ê–Ω—Ç–∏—Ñ—Ä–æ–¥ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `anti_fraud_suspicious_*`.
6. üßæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –≤ audit-—Ç–∞–±–ª–∏—Ü—ã –∏ `history_history`.
7. üè¢ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–Ω–∫–∞—Ö (`public_bank_information_*`).

---

## ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

> **–°—Ü–µ–Ω–∞—Ä–∏–π:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

1. –ò–∑ `auth_users` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å (`profile_id`).
2. –ü–æ `profile_id` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `account_details_id`.
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `transfer_phone_transfer`.
4. –í `transfer_audit` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Ñ–∞–∫—Ç –ø–µ—Ä–µ–≤–æ–¥–∞.
5. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è ‚Äî –∑–∞–ø–∏—Å—å –≤ `anti_fraud_suspicious_phone_transfer`.
6. –ò—Ç–æ–≥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `history_history`.

---

## üß≠ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

![img.png](img.png)

---

## ‚öôÔ∏è PostgreSQL SQL-–ø—Ä–∏–º–µ—Ä—ã

### ‚ñ∂ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

```sql
BEGIN;

WITH new_user AS (
    INSERT INTO auth_users (username, password_hash, role_id)
    VALUES ('ivan.petrov', crypt('password123', gen_salt('bf')), 1)
    RETURNING id AS user_id
),
new_profile AS (
    INSERT INTO profile.profile (name_on_card, phone_number)
    VALUES ('IVAN PETROV', '+79998887766')
    RETURNING id AS profile_id
)
UPDATE auth_users 
SET profile_id = (SELECT profile_id FROM new_profile)
WHERE id = (SELECT user_id FROM new_user);

INSERT INTO profile.passport (series, number, issue_date, issued_by, profile_id)
VALUES ('4004', '123456', '2020-03-12', '–ì–£ –ú–í–î –†–§', (SELECT profile_id FROM new_profile));

INSERT INTO profile_actual_registration (country, region, city, street, house_number, profile_id)
VALUES ('–†–æ—Å—Å–∏—è', '–ú–æ—Å–∫–≤–∞', '–ú–æ—Å–∫–≤–∞', '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '12', (SELECT profile_id FROM new_profile));

COMMIT;
```

---

### ‚ñ∂ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞

```sql
BEGIN;

WITH new_account AS (
    INSERT INTO account_account_details (account_number, profile_id, balance)
    VALUES ('40817810099910000001', 1, 0.00)
    RETURNING id AS account_details_id
)
INSERT INTO account_account (entity_type, operation_type, created_by, created_at, profile_id)
VALUES ('ACCOUNT', 'CREATE', 'system', NOW(), 1);

COMMIT;
```

---

### ‚ñ∂ –ü–µ—Ä–µ–≤–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞

```sql
BEGIN;

WITH transfer_data AS (
    INSERT INTO transfer_phone_transfer (phone_number, amount, purpose, account_details_id)
    VALUES ('+79261234567', 2500.00, '–ü–µ—Ä–µ–≤–æ–¥ –¥—Ä—É–≥—É', 1)
    RETURNING id
)
INSERT INTO transfer_audit (entity_type, operation_type, created_by, timestamp, entity_json)
VALUES (
    'TRANSFER', 
    'PHONE', 
    'ivan.petrov', 
    NOW(), 
    json_build_object('amount', 2500, 'to', '+79261234567')
);

COMMIT;
```

---

### ‚ñ∂ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞

```sql
INSERT INTO anti_fraud_suspicious_phone_transfer (phone_transfer_id, is_blocked, suspicious_reason)
SELECT id, TRUE, '–°—É–º–º–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ª–∏–º–∏—Ç'
FROM transfer_phone_transfer
WHERE amount > 10000;
```

---

### ‚ñ∂ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é

```sql
INSERT INTO history_history (profile_audit_id, account_audit_id, transfer_audit_id)
VALUES (
    NULL,
    NULL,
    (SELECT id FROM transfer_audit ORDER BY id DESC LIMIT 1)
);
```

---

### ‚ñ∂ –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞

```sql
CREATE OR REPLACE FUNCTION register_new_client(
    p_username TEXT,
    p_password TEXT,
    p_name_on_card TEXT,
    p_phone TEXT
)
RETURNS VOID AS $$
DECLARE
    v_user_id INT;
    v_profile_id INT;
BEGIN
    INSERT INTO auth_users (username, password_hash, role_id)
    VALUES (p_username, crypt(p_password, gen_salt('bf')), 1)
    RETURNING id INTO v_user_id;

    INSERT INTO profile_profile (name_on_card, phone_number)
    VALUES (p_name_on_card, p_phone)
    RETURNING id INTO v_profile_id;

    UPDATE auth_users SET profile_id = v_profile_id WHERE id = v_user_id;

    INSERT INTO account_account_details (account_number, profile_id, balance)
    VALUES (LPAD(TRUNC(random() * 999999999)::TEXT, 20, '0'), v_profile_id, 0.00);

    RAISE NOTICE '–ö–ª–∏–µ–Ω—Ç % —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', p_username;
END;
$$ LANGUAGE plpgsql;
```

---

### ‚ñ∂ –í—ã–∑–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

```sql
CALL register_new_client('ivan.petrov', 'MyStrongPass123', 'IVAN PETROV', '+79998887766');
```



---

## üìò –†–µ–∑—é–º–µ

| –ú–æ–¥—É–ª—å | –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è | –ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã |
|--------|------------------|------------------|
| **–ü—Ä–æ—Ñ–∏–ª—å** | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ | `profile_*` |
| **–°—á–µ—Ç–∞** | –†–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –±–∞–ª–∞–Ω—Å | `account_*` |
| **–ü–µ—Ä–µ–≤–æ–¥—ã** | –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | `transfer_*` |
| **–ê–Ω—Ç–∏—Ñ—Ä–æ–¥** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π | `anti_fraud_*` |
| **–ò—Å—Ç–æ—Ä–∏—è** | –ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π | `history_history` |
| **–ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** | –î–∞–Ω–Ω—ã–µ –æ –±–∞–Ω–∫–∞—Ö –∏ —Ñ–∏–ª–∏–∞–ª–∞—Ö | `public_bank_information_*` |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** | –î–æ—Å—Ç—É–ø –∏ —Ä–æ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ | `auth_users` |

---
































<h2>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ "–ú–µ—Ç–∞-–ë–∞–Ω–∫" –æ—Ç –ö—ã–≤—ã—Ä–∂–∏–∫ –ê.–ì. –æ—Ç 13.04.2023</h2>

- [Summary](#summary)
- [Stack](#stack)
- [MVP](#mvp)
- [–ë—ç–∫–µ–Ω–¥](#–±—ç–∫–µ–Ω–¥)
- [–†–∞–±–æ—Ç–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–µ](#—Ä–∞–±–æ—Ç–∞-–Ω–∞-–ø—Ä–æ–µ–∫—Ç–µ)
    - [–° —á–µ–≥–æ –Ω–∞—á–∏–Ω–∞—Ç—å](#—Å-—á–µ–≥–æ-–Ω–∞—á–∏–Ω–∞—Ç—å)
    - [–û —Ç–∞—Å–∫–±–æ—Ä–¥–µ](#–æ-—Ç–∞—Å–∫–±–æ—Ä–¥–µ)
    - [–ö–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏](#–∫–∞–∫-–≤—ã–ø–æ–ª–Ω—è—Ç—å-–∑–∞–¥–∞—á–∏)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–∑–∞–¥–∞—á)
    - [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–¥—É](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-–∫–æ–¥—É)
    - [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

### Summary

–†–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î (–ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –æ–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è).

### Stack

`Java 17`
`Spring Boot 2` - –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ç–∫–∞.
`Maven` - –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏.
`PostgreSQL` - –∫–∞–∫ –ë–î.
`Spring Data` - –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.
`Hibernate` - –∫–∞–∫ ORM.
`Lombok` - —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å boilerplate-–∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞ –ø—Ä–æ–µ–∫—Ç–µ [Lombok](https://projectlombok.org/features/all).
`Mapstruct` - –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞, [Mapstruct](https://www.baeldung.com/mapstruct).
`Liquibase` - –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, [–°—Å—ã–ª–∫–∞ 1](https://habr.com/ru/post/460377/). [–°—Å—ã–ª–∫–∞ 2](https://habr.com/ru/post/460907/).
`Openfeign` - –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç–≤—Ä–∏–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞, –∏ —Ñ–µ–π–Ω-–∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏.
`Springdoc-openapi-ui` - [Swagger](https://docs.swagger.io/swagger-core/v1.5.0/apidocs/allclasses-noframe.html).
`Junit5` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
`Mockito` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
`Spring Test` - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.
`Spring-security` - –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
`Docker` - –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
`Postman` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å—ã.
`Visual paradigm` - –¥–ª—è –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –±–∞–∑–æ–≤—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ–Ω–¥–∂–ª–æ–≥–æ–≤.

### MVP

[MVP](https://ru.wikipedia.org/wiki/%D0%9C%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE_%D0%B6%D0%B8%D0%B7%D0%BD%D0%B5%D1%81%D0%BF%D0%BE%D1%81%D0%BE%D0%B1%D0%BD%D1%8B%D0%B9_%D0%BF%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82) - API (–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ Swagger).
–†–∞–±–æ—Ç–∞—Ç—å —Å —Ç–∞–∫–∏–º API –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Swagger –∏ Postman.

### –ë—ç–∫–µ–Ω–¥

–ü—Ä–æ–µ–∫—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.
–ê –∫–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≤—ã—Å—Ç—Ä–æ–µ–Ω –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ REST.
–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ–±—ã –ø–æ –ª–æ–≥–∏–∫–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –ª–µ–∂–∞–ª–∏ –≤ –æ–¥–Ω–æ–º –ø–∞–∫–µ—Ç–µ.

–°–ª–æ–∏:
<ul>
<li><code>config</code> –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã</li>
<li><code>entity</code> —Å—É—â–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</li>
<li><code>dto</code> —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏/–ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤/—Å –∞–ø–∏</li>
<li><code>repository</code> dao-—Å–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ä–µ–∞–ª–∏–∑—É–µ–º –≤ –≤–∏–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ Spring Data, –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É—é—â–∏—Ö JpaRepository.</li>
<li><code>service</code> –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ä–µ–∞–ª–∏–∑—É–µ–º –≤ –≤–∏–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä—É—é—â–∏—Ö –∏—Ö –∫–ª–∞—Å—Å–æ–≤.</li>
<li><code>controller</code> –æ–±—ã—á–Ω—ã–µ –∏ rest-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</li>
<li><code>validator</code> –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤.</li>
<li><code>exception</code> —ç–∫—Å–µ–ø—à–Ω–æ–≤.</li>
<li><code>handler</code> —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤.</li>
</ul>

